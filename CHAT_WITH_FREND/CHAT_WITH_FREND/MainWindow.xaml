<Window x:Class="CHAT_WITH_FREND.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
        mc:Ignorable="d"
        Title="LAN Chat" Height="650" Width="950" 
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <PathGeometry x:Key="IconSend">M2.01 21L23 12 2.01 3 2 10l15 2-15 2z</PathGeometry>
        <PathGeometry x:Key="IconImage">M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z</PathGeometry>
        <PathGeometry x:Key="IconFile">M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M13,9V3.5L18.5,9H13z</PathGeometry>
        <PathGeometry x:Key="IconEmoji">M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z M15.5 11c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5 14.67 11 15.5 11zM8.5 11c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zM12 17.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z</PathGeometry>

        <Style TargetType="Button" x:Key="IconBtn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="35"/>
            <Setter Property="Height" Value="35"/>
            <Setter Property="Margin" Value="2"/>
        </Style>
    </Window.Resources>

    <Grid Background="#F5F5F5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="220"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
            <DockPanel>
                <Border DockPanel.Dock="Top" Height="60" Background="#0091FF">
                    <StackPanel VerticalAlignment="Center" Margin="15,0">
                        <TextBlock Text="LAN CHAT" Foreground="White" FontSize="18" FontWeight="Bold"/>
                        <TextBlock x:Name="CurrentUserText" Text="Đang kết nối..." Foreground="#E0E0E0" FontSize="12"/>
                    </StackPanel>
                </Border>
                <ListBox x:Name="UserListBox" BorderThickness="0" SelectionChanged="UserListBox_SelectionChanged" Background="#FAFAFA">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="10" CornerRadius="5" Margin="2">
                                <StackPanel Orientation="Horizontal">
                                    <Ellipse Width="10" Height="10" Fill="LimeGreen" Margin="0,0,10,0"/>
                                    <TextBlock Text="{Binding}" FontSize="14" FontWeight="SemiBold"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
                <TextBlock x:Name="ChatTitleText" Text="Chat Nhóm" VerticalAlignment="Center" Margin="20,0" FontSize="16" FontWeight="Bold"/>
            </Border>

            <ListBox x:Name="MessagesListBox" Grid.Row="1" Background="#EFEFEF" BorderThickness="0" 
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid Margin="0,5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Border Grid.Row="0" Background="White" CornerRadius="8" Padding="10,8" HorizontalAlignment="Left" MaxWidth="550">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="5" Color="#DDD" ShadowDepth="1" Opacity="0.4"/>
                                </Border.Effect>
                                <ContentControl Content="{Binding Content}"/>
                            </Border>

                            <TextBlock Grid.Row="1" Text="{Binding Timestamp}" FontSize="10" Foreground="#888" Margin="5,2,0,0"/>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>

            <Border Grid.Row="2" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0">
                <StackPanel>

                    <Border x:Name="PreviewBorder" Visibility="Collapsed" Background="#F0F0F0" Padding="10" Margin="10,10,10,0" CornerRadius="5">
                        <DockPanel>
                            <Button DockPanel.Dock="Right" Content="✕" Width="20" Height="20" Background="Transparent" 
                                    BorderThickness="0" Foreground="Red" Click="RemoveAttachment_Click" VerticalAlignment="Top"/>
                            <StackPanel Orientation="Horizontal">
                                <Image x:Name="PreviewImage" Height="60" Margin="0,0,10,0" Stretch="Uniform"/>
                                <TextBlock x:Name="PreviewFileName" Text="filename.txt" VerticalAlignment="Center" FontWeight="Bold"/>
                            </StackPanel>
                        </DockPanel>
                    </Border>

                    <Grid Margin="5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0" Style="{StaticResource IconBtn}" Click="AttachImage_Click" ToolTip="Gửi ảnh">
                            <Path Data="{StaticResource IconImage}" Fill="#0091FF" Width="22" Height="22"/>
                        </Button>

                        <Button Grid.Column="1" Style="{StaticResource IconBtn}" Click="AttachFile_Click" ToolTip="Gửi file">
                            <Path Data="{StaticResource IconFile}" Fill="#555" Width="18" Height="22"/>
                        </Button>

                        <Button x:Name="EmojiButton" Grid.Column="2" Style="{StaticResource IconBtn}" Click="ToggleEmoji_Click" ToolTip="Biểu cảm">
                            <Path Data="{StaticResource IconEmoji}" Fill="#FFC107" Width="22" Height="22"/>
                        </Button>

                        <Popup x:Name="EmojiPopup" 
                               PlacementTarget="{Binding ElementName=EmojiButton}" 
                               Placement="Top" 
                               StaysOpen="False" 
                               AllowsTransparency="True" 
                               PopupAnimation="Fade">
                            <Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1" CornerRadius="8">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="15" Color="#B0B0B0" ShadowDepth="3" Opacity="0.5"/>
                                </Border.Effect>
                                <emoji:Picker x:Name="EmojiPicker" 
                                              SelectionChanged="EmojiPicker_SelectionChanged" 
                                              FontSize="24"
                                              Width="350" Height="400"/>
                            </Border>
                        </Popup>

                        <emoji:TextBox x:Name="MessageTextBox" Grid.Column="3" Margin="5,0" Padding="8" VerticalContentAlignment="Center"
                                       FontSize="15" BorderThickness="0" Background="#F5F5F5" 
                                       KeyDown="MessageTextBox_KeyDown"/>

                        <Button Grid.Column="4" Style="{StaticResource IconBtn}" Click="SendButton_Click" ToolTip="Gửi">
                            <Path Data="{StaticResource IconSend}" Fill="#0091FF" Width="24" Height="24"/>
                        </Button>
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>